From 89b2e8918e0babadbd34a64db172b068f5dc1dca Mon Sep 17 00:00:00 2001
From: Arthh <arthur.ulhoa28@gmail.com>
Date: Mon, 11 Aug 2025 15:51:52 -0300
Subject: [PATCH] feat: implement Under Review workflow for funding
 applications

- Add under_review status to FundingApplicationStatusV2 type
- Implement conditional button display based on application status:
  * Pending: Show only 'Start Review' button
  * Under Review: Show 'Approve', 'Reject', 'Request Revision' buttons
  * Other statuses: Show available actions as before
- Add under_review status styling (purple theme) in both list and detail views
- Update ApplicationDetailSidesheet and ApplicationList components
- Enhance admin review workflow with proper status transitions
- Improve UX with clear 'Start Review' action for pending applications
- Integrate with existing backend Under Review status implementation
---
 .../ApplicationList/ApplicationList.tsx       | 131 +++++++++++++-----
 .../ApplicationDetailSidesheet.tsx            |  86 +++++++++---
 types/funding-platform.ts                     |   1 +
 3 files changed, 166 insertions(+), 52 deletions(-)

diff --git a/components/FundingPlatform/ApplicationList/ApplicationList.tsx b/components/FundingPlatform/ApplicationList/ApplicationList.tsx
index bc6c27f3..5986b68a 100644
--- a/components/FundingPlatform/ApplicationList/ApplicationList.tsx
+++ b/components/FundingPlatform/ApplicationList/ApplicationList.tsx
@@ -26,6 +26,7 @@ interface IApplicationListComponentProps extends IApplicationListProps {
 
 const statusColors = {
   pending: "bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300",
+  under_review: "bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300",
   revision_requested:
     "bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300",
   approved: "bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",
@@ -216,49 +217,113 @@ const ApplicationList: FC<IApplicationListComponentProps> = ({
                   onStatusChange &&
                   application.status !== "withdrawn" && (
                     <div className="flex flex-wrap gap-2">
-                      {application.status !== "revision_requested" && (
+                      {/* For pending status: only show Under Review button */}
+                      {application.status === "pending" && (
                         <Button
                           onClick={(e) => {
                             e.stopPropagation();
-                            handleStatusChangeClick(
-                              application.id,
-                              "revision_requested"
-                            );
+                            handleStatusChangeClick(application.id, "under_review");
                           }}
                           variant="secondary"
-                          className="w-fit px-3 py-1 dark:text-white border bg-transparent border-gray-200 font-medium dark:border-gray-700 flex flex-row gap-2"
+                          className="w-fit px-3 py-1 border bg-transparent text-purple-500 font-medium border-purple-200 dark:border-purple-700 flex flex-row gap-2"
                           disabled={isUpdatingStatus}
                         >
-                          Request Revision
+                          Start Review
                         </Button>
                       )}
-                      {application.status !== "approved" && (
-                        <Button
-                          onClick={(e) => {
-                            e.stopPropagation();
-                            handleStatusChangeClick(application.id, "approved");
-                          }}
-                          variant="secondary"
-                          className="w-fit px-3 py-1 border bg-transparent text-green-500 font-medium border-green-200 dark:border-green-700 flex flex-row gap-2"
-                          disabled={isUpdatingStatus}
-                        >
-                          <CheckIcon className="w-4 h-4" />
-                          Approve
-                        </Button>
+
+                      {/* For under_review status: show all action buttons */}
+                      {application.status === "under_review" && (
+                        <>
+                          <Button
+                            onClick={(e) => {
+                              e.stopPropagation();
+                              handleStatusChangeClick(
+                                application.id,
+                                "revision_requested"
+                              );
+                            }}
+                            variant="secondary"
+                            className="w-fit px-3 py-1 dark:text-white border bg-transparent border-gray-200 font-medium dark:border-gray-700 flex flex-row gap-2"
+                            disabled={isUpdatingStatus}
+                          >
+                            Request Revision
+                          </Button>
+                          <Button
+                            onClick={(e) => {
+                              e.stopPropagation();
+                              handleStatusChangeClick(application.id, "approved");
+                            }}
+                            variant="secondary"
+                            className="w-fit px-3 py-1 border bg-transparent text-green-500 font-medium border-green-200 dark:border-green-700 flex flex-row gap-2"
+                            disabled={isUpdatingStatus}
+                          >
+                            <CheckIcon className="w-4 h-4" />
+                            Approve
+                          </Button>
+                          <Button
+                            onClick={(e) => {
+                              e.stopPropagation();
+                              handleStatusChangeClick(application.id, "rejected");
+                            }}
+                            variant="secondary"
+                            className="w-fit px-3 py-1 border bg-transparent text-red-500 font-medium border-red-200 dark:border-red-700 flex flex-row gap-2"
+                            disabled={isUpdatingStatus}
+                          >
+                            <XMarkIcon className="w-4 h-4" />
+                            Reject
+                          </Button>
+                        </>
                       )}
-                      {application.status !== "rejected" && (
-                        <Button
-                          onClick={(e) => {
-                            e.stopPropagation();
-                            handleStatusChangeClick(application.id, "rejected");
-                          }}
-                          variant="secondary"
-                          className="w-fit px-3 py-1 border bg-transparent text-red-500 font-medium border-red-200 dark:border-red-700 flex flex-row gap-2"
-                          disabled={isUpdatingStatus}
-                        >
-                          <XMarkIcon className="w-4 h-4" />
-                          Reject
-                        </Button>
+
+                      {/* For other statuses: show available actions except current status */}
+                      {!["pending", "under_review"].includes(application.status) && (
+                        <>
+                          {application.status !== "revision_requested" && (
+                            <Button
+                              onClick={(e) => {
+                                e.stopPropagation();
+                                handleStatusChangeClick(
+                                  application.id,
+                                  "revision_requested"
+                                );
+                              }}
+                              variant="secondary"
+                              className="w-fit px-3 py-1 dark:text-white border bg-transparent border-gray-200 font-medium dark:border-gray-700 flex flex-row gap-2"
+                              disabled={isUpdatingStatus}
+                            >
+                              Request Revision
+                            </Button>
+                          )}
+                          {application.status !== "approved" && (
+                            <Button
+                              onClick={(e) => {
+                                e.stopPropagation();
+                                handleStatusChangeClick(application.id, "approved");
+                              }}
+                              variant="secondary"
+                              className="w-fit px-3 py-1 border bg-transparent text-green-500 font-medium border-green-200 dark:border-green-700 flex flex-row gap-2"
+                              disabled={isUpdatingStatus}
+                            >
+                              <CheckIcon className="w-4 h-4" />
+                              Approve
+                            </Button>
+                          )}
+                          {application.status !== "rejected" && (
+                            <Button
+                              onClick={(e) => {
+                                e.stopPropagation();
+                                handleStatusChangeClick(application.id, "rejected");
+                              }}
+                              variant="secondary"
+                              className="w-fit px-3 py-1 border bg-transparent text-red-500 font-medium border-red-200 dark:border-red-700 flex flex-row gap-2"
+                              disabled={isUpdatingStatus}
+                            >
+                              <XMarkIcon className="w-4 h-4" />
+                              Reject
+                            </Button>
+                          )}
+                        </>
                       )}
                     </div>
                   )}
diff --git a/components/FundingPlatform/ApplicationView/ApplicationDetailSidesheet.tsx b/components/FundingPlatform/ApplicationView/ApplicationDetailSidesheet.tsx
index 1f48bdb3..40b4f82f 100644
--- a/components/FundingPlatform/ApplicationView/ApplicationDetailSidesheet.tsx
+++ b/components/FundingPlatform/ApplicationView/ApplicationDetailSidesheet.tsx
@@ -29,6 +29,7 @@ interface ApplicationDetailSidesheetProps {
 
 const statusColors = {
   pending: "bg-blue-100 text-blue-800 border-blue-200",
+  under_review: "bg-purple-100 text-purple-800 border-purple-200",
   revision_requested: "bg-yellow-100 text-yellow-800 border-yellow-200",
   approved: "bg-green-100 text-green-800 border-green-200",
   rejected: "bg-red-100 text-red-800 border-red-200",
@@ -37,6 +38,7 @@ const statusColors = {
 
 const statusIcons = {
   pending: ClockIcon,
+  under_review: ClockIcon,
   revision_requested: ExclamationTriangleIcon,
   approved: CheckCircleIcon,
   rejected: XMarkIcon,
@@ -586,9 +588,23 @@ const ApplicationDetailSidesheet: FC<ApplicationDetailSidesheetProps> = ({
                       {showStatusActions && onStatusChange && (
                         <div className="border-t border-gray-200 dark:border-gray-700 bg-zinc-50 dark:bg-zinc-800 px-4 py-4 sm:px-6">
                           <div className="flex flex-col space-y-2">
-                            {/* Show all available actions except the current status */}
-                            <div className="flex space-x-3">
-                              {application.status !== "revision_requested" && (
+                            {/* For pending status: only show Under Review button */}
+                            {application.status === "pending" && (
+                              <div className="flex space-x-3">
+                                <Button
+                                  onClick={() => handleStatusChangeClick("under_review")}
+                                  variant="primary"
+                                  className="flex-1 bg-purple-600 hover:bg-purple-700"
+                                  disabled={isUpdatingStatus}
+                                >
+                                  Start Review
+                                </Button>
+                              </div>
+                            )}
+
+                            {/* For under_review status: show all action buttons */}
+                            {application.status === "under_review" && (
+                              <div className="flex space-x-3">
                                 <Button
                                   onClick={() =>
                                     handleStatusChangeClick("revision_requested")
@@ -599,8 +615,6 @@ const ApplicationDetailSidesheet: FC<ApplicationDetailSidesheetProps> = ({
                                 >
                                   Request Revision
                                 </Button>
-                              )}
-                              {application.status !== "approved" && (
                                 <Button
                                   onClick={() => handleStatusChangeClick("approved")}
                                   className="flex-1 bg-green-600 hover:bg-green-700"
@@ -608,8 +622,6 @@ const ApplicationDetailSidesheet: FC<ApplicationDetailSidesheetProps> = ({
                                 >
                                   Approve
                                 </Button>
-                              )}
-                              {application.status !== "rejected" && (
                                 <Button
                                   onClick={() => handleStatusChangeClick("rejected")}
                                   className="flex-1 bg-red-600 hover:bg-red-700"
@@ -617,22 +629,58 @@ const ApplicationDetailSidesheet: FC<ApplicationDetailSidesheetProps> = ({
                                 >
                                   Reject
                                 </Button>
-                              )}
-                            </div>
-
-                            {application.status === "revision_requested" && (
-                              <p className="text-xs text-gray-500 dark:text-gray-400">
-                                The applicant can update their submission.
-                              </p>
+                              </div>
                             )}
 
-                            {application.status === "withdrawn" && (
-                              <p className="text-sm text-gray-500 dark:text-gray-400 text-center py-2">
-                                This application has been withdrawn by the
-                                applicant.
-                              </p>
+                            {/* For other statuses: show available actions except current status */}
+                            {!["pending", "under_review"].includes(application.status) && (
+                              <div className="flex space-x-3">
+                                {application.status !== "revision_requested" && (
+                                  <Button
+                                    onClick={() =>
+                                      handleStatusChangeClick("revision_requested")
+                                    }
+                                    variant="secondary"
+                                    className="flex-1"
+                                    disabled={isUpdatingStatus}
+                                  >
+                                    Request Revision
+                                  </Button>
+                                )}
+                                {application.status !== "approved" && (
+                                  <Button
+                                    onClick={() => handleStatusChangeClick("approved")}
+                                    className="flex-1 bg-green-600 hover:bg-green-700"
+                                    disabled={isUpdatingStatus}
+                                  >
+                                    Approve
+                                  </Button>
+                                )}
+                                {application.status !== "rejected" && (
+                                  <Button
+                                    onClick={() => handleStatusChangeClick("rejected")}
+                                    className="flex-1 bg-red-600 hover:bg-red-700"
+                                    disabled={isUpdatingStatus}
+                                  >
+                                    Reject
+                                  </Button>
+                                )}
+                              </div>
                             )}
                           </div>
+
+                          {application.status === "revision_requested" && (
+                            <p className="text-xs text-gray-500 dark:text-gray-400">
+                              The applicant can update their submission.
+                            </p>
+                          )}
+
+                          {application.status === "withdrawn" && (
+                            <p className="text-sm text-gray-500 dark:text-gray-400 text-center py-2">
+                              This application has been withdrawn by the
+                              applicant.
+                            </p>
+                          )}
                         </div>
                       )}
                     </div>
diff --git a/types/funding-platform.ts b/types/funding-platform.ts
index a3645a56..eeb347a3 100644
--- a/types/funding-platform.ts
+++ b/types/funding-platform.ts
@@ -1,6 +1,7 @@
 // V2 Status Types
 export type FundingApplicationStatusV2 = 
   | "pending"
+  | "under_review"
   | "revision_requested" 
   | "approved"
   | "rejected"
-- 
2.43.0

